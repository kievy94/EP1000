<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="styles.css">
		<title>Welcome To My Website</title>
	</head>
	
	<body>
		<div id="container" width="900">
			<div id="header">
				<h1>Welcome To My Website<h1>
		</div>
		
		<div id="content">
			<div id="nav">
				<h3>Navigation</h3>
				<ul>
					<li><a class="selected" href="index.html">Home</a></li>
					<li><a href="2dgraphics.html">2D Graphics</a></li>
					<li><a href="cad.html">CAD</a></li>
					<li><a href="arduino.html">Arduino</a></li>
					<li><a href="topics.html">Topics Learnt</a></li>
					<li><a href="project.html">Project</a></li>
					<li><a href="about.html">About</a></li>
					<li><a href="contact.html">Contact</a></li>
				</ul>
			</div>
		
			<div id="main">
				<h2>Project</h2>
				<p> This page will show case the process of the whole project</p>
				<p> The project theme is a handheld game console of the rock-paper-stone.</p>
				<p> the user would have to select their input to challenge the arduino.</p>
				
				<h3>Arduino</h3>
				<p> Program of the rock-paper-stone.</p>
				<p> #include <LiquidCrystal_I2C.h>
					LiquidCrystal_I2C lcd(32,16,2);

					#define ACTION_BTN 8
					#define ROCK_BTN 9
					#define PAPER_BTN 10
					#define SCISSORS_BTN 11
					#define ROCK_LED 2
					#define PAPER_LED 3
					#define SCISSORS_LED 4

					#define BTN_DEBOUNCE_DELAY 250

					unsigned long lastButtonDetection = 0UL;
					unsigned int mode = 0;
					unsigned int pick = 0;
					unsigned int user_pick = 0;
					unsigned int player_score = 0;
					unsigned int arduino_score = 0;

					// Lines = Arduino's choice
					// Columns = Player's choice
					const int win_matrix[3][3] = {
					  // Player chose rock, Player chose paper, Player chose scissors
					  { 0,                  1,                  -1 },                        // Arduino chose rock
					  { -1,                 0,                   1 },                        // Arduino chose paper
					  { 1,                  -1,                  0 }                         // Arduino chose scissors
					};
					void setup()
					{
					  Serial.begin(9600);

					  pinMode(ACTION_BTN, INPUT);
					  pinMode(ROCK_BTN, INPUT);
					  pinMode(PAPER_BTN, INPUT);
					  pinMode(SCISSORS_BTN, INPUT);
					  pinMode(ROCK_LED, OUTPUT);
					  pinMode(PAPER_LED, OUTPUT);
					  pinMode(SCISSORS_LED, OUTPUT);
					  lcd.init();
					  lcd.clear();         
					  lcd.backlight();
					  lcd.begin(16, 2);
					  lcd.print("SPR-2000");
					  delay(1000);
					  
					}
					int readButtons(void)
					{
					  unsigned long current = millis();
					  int detectedButton = -1;

					  if(current - lastButtonDetection > BTN_DEBOUNCE_DELAY)
					  {
						if(digitalRead(ACTION_BTN))
						  detectedButton = ACTION_BTN;
						else if(digitalRead(ROCK_BTN))
						  detectedButton = ROCK_BTN;
						else if(digitalRead(PAPER_BTN))
						  detectedButton = PAPER_BTN;
						else if(digitalRead(SCISSORS_BTN))
						  detectedButton = SCISSORS_BTN;
					  }

					  lastButtonDetection = (detectedButton != -1) ? current : lastButtonDetection;
					  return detectedButton;
					}

					int checkWinner(void)
					{
					  return win_matrix[pick][user_pick];
					}

					void tie(void)
					{
					  lcd.clear();
					  lcd.print("Tie!");
					  delay(1000);
					  
					  Serial.println("Tie!");
					  
					  selectLED(2);
					}

					void playerWins(void)
					{
					  player_score += 1;
					  lcd.clear();
					  lcd.print("You Win!");
					  delay(1000);
					  
					  Serial.println("You win!");
					  
					  selectLED(1);
					}

					void arduinoWins(void)
					{
					  arduino_score += 1;
					  lcd.clear();
					  lcd.print("Arduino Win!");
					  delay(1000);
					  Serial.println("The Arduino wins!");
					  
					  selectLED(0);
					}

					void turnOffLEDs(void)
					{
					  digitalWrite(ROCK_LED, LOW);
					  digitalWrite(PAPER_LED, LOW);
					  digitalWrite(SCISSORS_LED, LOW);
					}

					void selectLED(int pick)
					{
					  turnOffLEDs();
					  digitalWrite((ROCK_LED + pick), HIGH);
					}

					void loop()
					{
					  // Idle mode
					  if(mode == 0)
					  {
						lcd.clear();
						lcd.print("Press any button");
						lcd.setCursor(0,1);
						lcd.print("to begin");
						
						Serial.println("Press any button to begin!");
						
						mode = 1;
					  }

					  // Waiting for the user to start a new game
					  // Once the user presses a button, the Arduino thinks of its game move
					  if(mode == 1)
					  {
						if(readButtons() != -1)
						{
						  mode = 2;
						  pick = random(0,3); // 0 = rock; 1 = paper; 2 = scissors
						  lcd.clear();
						  lcd.setCursor(0,0);
						  lcd.print("Choose Your");
						  lcd.setCursor(0,1);
						  lcd.print("Move");
						  Serial.println("Choose either rock, paper, or scissors!");
						   
						}
					  }

					  // Waiting for the user to pick an option
					  if(mode == 2)
					  {
						int pressedButton = readButtons();
						selectLED(user_pick);
						if(pressedButton == ACTION_BTN)
						{
						  Serial.print("The player chose ");
						  Serial.println((user_pick == 0) ? "rock" : ((user_pick == 1) ? "paper" : "scissors"));
						  turnOffLEDs();
						  mode = 3;
						}
						else if(pressedButton != -1)
						{
						  user_pick = pressedButton - ACTION_BTN - 1;
						}
					  }

					  // Check who wins this round
					  if(mode == 3) 
					  {
						Serial.print("The Arduino chose ");
						Serial.println((pick == 0) ? "rock" : ((pick == 1) ? "paper" : "scissors"));
						if(checkWinner() == -1)
						  arduinoWins();
						else if(checkWinner() == 1)
						  playerWins();
						else
						  tie();
						Serial.println("");
						Serial.println("-- Current score --");
						Serial.print("Arduino: ");
						Serial.println(arduino_score);
						Serial.print("You: ");
						Serial.println(player_score);
						Serial.println("-------------------");
						Serial.println("");
						lcd.clear();
						lcd.setCursor(0,0);
						lcd.print("Arduino:" );
						lcd.setCursor(8,0);
						lcd.print(arduino_score);
						delay(200);
						lcd.setCursor(0,1);
						lcd.print("You:" );
						lcd.setCursor(4,1);
						lcd.print(player_score);
						delay(2000);
						mode = 0;
						
					  }
					}
				</p>
				<br>
				<h3>Wiring</h3>
				<p> Wiring of I/O devices with arduino</p>
				
				<h3>CAD</h3>
				<p> 3D model of the game console.</p>
				
				
			</div>
			
			<div id="footer">
				Copyright &copy; 2022 Kiev Lai
			</div>
			
		</div>	
	</body>
	
</html>